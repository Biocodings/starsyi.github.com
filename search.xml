<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
    
    <entry>
      <title><![CDATA[SAM文件格式说明]]></title>
      <url>http://yoursite.com/2016/05/24/SAM%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F%E8%AF%B4%E6%98%8E/</url>
      <content type="html"><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>文件后缀名:.sam</p>
<p>bwa、Bowtie2是现下最流行的短序列比对软件，SAM(Sequence Alignment/Map)格式是一种通用的比对格式，用来存储reads到参考序列的比对信息。<br>SAM是一种序列比对格式标准，由sanger制定，是以TAB为分割符的文本格式。主要应用于测序序列mapping到基因组上的结果表示，当然也可以表示任意的多重比对结果。<br>不同的软件，不同的时期，不同的研究方向，都会创建一种或者多种格式标准，当然根据当时的需要，创建符合需求的标准，也是最容易的事情，而反过来想要真正的理解标准，也必须理解为什么要创建这样的标准，解决什么样的需要。我前面的有篇文章已经对于现有的多重比对的格式进行总结，但其更多的站在比较基因组学的角度。当我们去了解sam标准格式是什么的时候，就要思考既然以及有了这么多得标准，为什么还要定义SAM标准，当然拿所有的格式进行比较也并非易事，但是简单的对比，就可以了解其中一二，比如aln格式，是比对视图化的展示，存储的信息不够结构化，无法方便的作为另外程序的输入；表示信息的有限性，如果100个多重比对序列放到一个文件中，查看维护就会非常困难；还有些格式标准挺强大，但是太繁琐，同时不够灵活。那么反过来就是SAM格式的优点，那么SAM如何做到这一点的呢？</p>
<p>SAM要处理好的问题：</p>
<pre><code>1. 非常多序列（read)，mapping到多个参考基因组（reference）上；
2. 同一条序列，分多段（segment）比对到参考基因组上；
3. 无限量的，结构化信息表示，包括错配、删除、插入等比对信息；
</code></pre><h2 id="行、列、注释说明"><a href="#行、列、注释说明" class="headerlink" title="行、列、注释说明"></a>行、列、注释说明</h2><p>SAM分为两部分，注释信息（header section）和比对结果部分（alignment section）。<br>行：除注释外，每一行是一个read<br>注释信息可有可无，都是以@开头，用不同的tag表示不同的信息，主要有：<br><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@HD</span>，说明符合标准的版本、对比序列的排列顺序；</span><br><span class="line"><span class="variable">@SQ</span>，参考序列说明；</span><br><span class="line"><span class="variable">@RG</span>，比对上的序列（read）说明；</span><br><span class="line"><span class="variable">@PG</span>，使用的程序说明；</span><br><span class="line"><span class="variable">@CO</span>，任意的说明信息。</span><br></pre></td></tr></table></figure></p>
<p>比对结果部分（alignment section），每一行表示一个片段（segment）的比对信息，包括11个必须的字段（mandatory fields）和一个可选的字段，字段之间用tag分割。必须的字段有11个，顺序固定，不可用时，根据字段定义，可以为’0’或者’*’，这是11个字段包括：<br><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> QNAME    比对片段的（template）的编号；read name，read的名字通常包括测序平台等信息</span><br><span class="line"><span class="meta"># eg.ILLUMINA-379DBF:1:1:3445:946#0/1</span></span><br><span class="line"><span class="number">2.</span> FLAG     位标识，template mapping情况的数字表示，每一个数字代表一种比对情况，这里的值是符合情况的数字相加总和；flag取值见备注(<span class="number">3</span>)</span><br><span class="line"><span class="meta"># eg.16</span></span><br><span class="line"><span class="number">3.</span> RNAME    参考序列的编号，如果注释中对SQ-SN进行了定义，这里必须和其保持一致，另外对于没有mapping上的序列，这里是<span class="string">'*'</span>；</span><br><span class="line"><span class="meta"># eg.chr1</span></span><br><span class="line"><span class="number">4.</span> POS      比对上的位置，注意是从<span class="number">1</span>开始计数，没有比对上，此处为<span class="number">0</span>;</span><br><span class="line"><span class="meta"># eg.36576599</span></span><br><span class="line"><span class="number">5.</span> MAPQ     mappint的质量,，比对的质量分数，越高说明该read比对到参考基因组上的位置越唯一;</span><br><span class="line"><span class="meta"># eg.42</span></span><br><span class="line"><span class="number">6.</span> CIGAR    简要比对信息表达式（Compact Idiosyncratic Gapped Alignment Report），其以参考序列为基础，使用数字加字母表示比对结果，match/mismatch、insertion、deletion 对应字母 M、I、D。比如<span class="number">3</span>S6M1P1I4M，前三个碱基被剪切去除了，然后<span class="number">6</span>个比对上了，然后打开了一个缺口，有一个碱基插入，最后是<span class="number">4</span>个比对上了，是按照顺序的；</span><br><span class="line"><span class="meta"># eg.36M 表示36个碱基在比对时完全匹配</span></span><br><span class="line"></span><br><span class="line"><span class="meta">###注：第七列到第九列是mate(备注1)的信息，若是单末端测序这几列均无意义###</span></span><br><span class="line"></span><br><span class="line"><span class="number">7.</span> RNEXT    下一个片段（即mate）比对上的参考序列的编号，没有另外的片段，这里是<span class="string">'*'</span>，同一个片段，用<span class="string">'='</span>；</span><br><span class="line"><span class="meta"># eg.*</span></span><br><span class="line"><span class="number">8.</span> PNEXT    下一个片段（即mate）比对到参考序列上的第一个碱基位置，若无mate,则为<span class="number">0</span>；</span><br><span class="line"><span class="meta"># eg.0</span></span><br><span class="line"><span class="number">9.</span> TLEN     Template的长度，最左边得为正，最右边的为负，中间的不用定义正负，不分区段（single-segment)的比对上，或者不可用时，此处为<span class="number">0</span>(ISIZE，Inferred fragment size.详见Illumina中paired end sequencing 和 mate pair sequencing，是负数，推测应该是两条read之间的间隔(待查证)，若无mate则为<span class="number">0</span>);</span><br><span class="line"><span class="meta"># eg.0</span></span><br><span class="line"><span class="number">10.</span> SEQ     序列片段的序列信息，如果不存储此类信息，此处为<span class="string">'*'</span>，注意CIGAR中M/I/S/=/X对应数字的和要等于序列长度；</span><br><span class="line"><span class="meta"># eg.CGTTTCTGTGGGTGATGGGCCTGAGGGGCGTTCTCN</span></span><br><span class="line"><span class="number">11.</span> QUAL    序列的质量信息,read质量的ASCII编码。，格式同FASTQ一样。</span><br><span class="line"><span class="meta"># eg.PY[[YY_______________QQQQbILKIGEFGKB</span></span><br><span class="line"><span class="number">12.</span>第十二列之后：Optional fields，以tab建分割。详见备注(<span class="number">2</span>)</span><br><span class="line"><span class="meta"># eg.AS:i:-1 XN:i:0 XM:i:1 XO:i:0 XG:i:0 NM:i:1 MD:Z:35T0 YT:Z:UU</span></span><br></pre></td></tr></table></figure></p>
<p>可选字段（optional fields)，格式如：TAG:TYPE:VALUE，其中TAG有两个大写字母组成，每个TAG代表一类信息，每一行一个TAG只能出现一次，TYPE表示TAG对应值的类型，可以是字符串、整数、字节、数组等。</p>
<p>要注意的几个概念，以及与之对应的模型：<br><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">·   reference</span><br><span class="line">·   <span class="built_in">read</span></span><br><span class="line">·   segment</span><br><span class="line">·   <span class="keyword">template</span>（参考序列和比对上的序列共同组成的序列为<span class="keyword">template</span>）</span><br><span class="line">·   alignment</span><br><span class="line">·   seq</span><br></pre></td></tr></table></figure></p>
<h2 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a><strong>扩展</strong></h2><h2 id="备注"><a href="#备注" class="headerlink" title="备注"></a>备注</h2><p>(1)mate，在Illuminated中有两种测序技术：paired end sequencing，mate pair sequencing。这两种测序都是测的一个片段的两端，这两端产生的reads被称为mate1，mate2，单末端测序则无mate。</p>
<p>(2)Optional fields：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">AS:</span><span class="string">i:</span>&lt;N&gt;</span><br><span class="line">    Alignment score.可以为负的，在local下可以为正的。 只有当Align≥<span class="number">1</span> time才出现</span><br><span class="line"><span class="string">XS:</span><span class="string">i:</span>&lt;N&gt;</span><br><span class="line">    Alignment score <span class="keyword">for</span> second-best alignment.  当Align&gt;<span class="number">1</span> time出现</span><br><span class="line"><span class="string">YS:</span><span class="string">i:</span>&lt;N&gt;</span><br><span class="line">    Alignment score <span class="keyword">for</span> opposite mate <span class="keyword">in</span> the paired-end alignment.   当该read是双末端测序中的一条时出现</span><br><span class="line"><span class="string">XN:</span><span class="string">i:</span>&lt;N&gt;</span><br><span class="line">    The number of ambiguous bases <span class="keyword">in</span> the reference covering <span class="keyword">this</span> alignment.（推测是指不知道错配发生在哪个位置，推测是针对于插入和缺失，待查证）</span><br><span class="line"><span class="string">XM:</span><span class="string">i:</span>&lt;N&gt;</span><br><span class="line">    错配碱基的数目</span><br><span class="line"><span class="string">XO:</span><span class="string">i:</span>&lt;N&gt;</span><br><span class="line">    The number of gap opens(针对于比对中的插入和缺失)</span><br><span class="line"><span class="string">XG:</span><span class="string">i:</span>&lt;N&gt;</span><br><span class="line">    The number of gap extensions(针对于比对中的插入和缺失)</span><br><span class="line"><span class="string">NM:</span><span class="string">i:</span>&lt;N&gt;</span><br><span class="line">    The edit distance(read string转换成reference string需要的最少核苷酸的<span class="string">edits:</span>插入<span class="regexp">/缺失/</span>替换)</span><br><span class="line"><span class="string">YF:</span><span class="string">Z:</span>&lt;S&gt;</span><br><span class="line">    该reads被过滤掉的原因。可能为LN(错配数太多，待查证)、NS(read中包含N或者．)、SC(match bonus低于设定的阈值)、QC(failing quality control，待证)</span><br><span class="line"><span class="string">YT:</span><span class="string">Z:</span>&lt;S&gt;</span><br><span class="line">    值为UU表示不是pair中一部分(单末端？)、CP(是pair且可以完美匹配)</span><br><span class="line">    DP(是pair但不能很好的匹配)、UP(是pair但是无法比对到参考序列上)</span><br><span class="line"><span class="string">MD:</span><span class="string">Z:</span>&lt;S&gt;</span><br><span class="line">    比对上的错配碱基的字符串表示</span><br></pre></td></tr></table></figure></p>
<p>(3)flag取值<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">0：比对到参考序列的正链上（待求证)</span><br><span class="line">1：是paired-<span class="keyword">end</span>或mate pair中的一条</span><br><span class="line"><span class="number">2</span>：双末端比对的一条</span><br><span class="line"><span class="number">4</span>：没有比对到参考序列上</span><br><span class="line"><span class="number">8</span>：是paired-<span class="keyword">end</span>或mate pair中的一条，且无法比对到参考序列上</span><br><span class="line"><span class="number">16</span>：比对到参考序列的负链上</span><br><span class="line"><span class="number">32</span>：双末端<span class="keyword">reads</span>的另一条（mate）比对到参考序列的负链上</span><br><span class="line"><span class="number">64</span>：这条<span class="keyword">read</span>是mate <span class="number">1</span></span><br><span class="line"><span class="number">128</span>：这条<span class="keyword">read</span>是mate <span class="number">2</span></span><br></pre></td></tr></table></figure></p>
<p>参考：<br>SAM的定义：<br><a href="http://boyun.sh.cn/bio/wp-content/uploads/2012/07/SAM1.pdf" target="_blank" rel="external">SAM1.pdf</a><br>samtools:<br><a href="http://sourceforge.net/projects/samtools/?source=directory" target="_blank" rel="external">samtools</a><br>发表的文献：<br><a href="http://www.ncbi.nlm.nih.gov/pmc/articles/PMC2723002/" target="_blank" rel="external">http://www.ncbi.nlm.nih.gov/pmc/articles/PMC2723002/</a><br>CIGAR的概念<br><a href="http://asia.ensembl.org/common/Help/Glossary?db=core" target="_blank" rel="external">http://asia.ensembl.org/common/Help/Glossary?db=core</a><br>一篇博客对于sam的解释<br><a href="http://boyun.sh.cn/bio/?p=1890" target="_blank" rel="external">博耘生物</a><br><a href="http://www.plob.org/2013/06/03/5870.html" target="_blank" rel="external">SAM格式-Bowtie2</a><br><a href="http://davetang.org/wiki/tiki-index.php?page=SAM" target="_blank" rel="external">http://davetang.org/wiki/tiki-index.php?page=SAM</a><br>perl模块<br><a href="http://search.cpan.org/~lds/Bio-SamTools/lib/Bio/DB/Sam.pm" target="_blank" rel="external">http://search.cpan.org/~lds/Bio-SamTools/lib/Bio/DB/Sam.pm</a></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[BWA 命令详解]]></title>
      <url>http://yoursite.com/2016/05/24/BWA-%E5%91%BD%E4%BB%A4%E8%AF%A6%E8%A7%A3/</url>
      <content type="html"><![CDATA[<h2 id="一、BWA-简介"><a href="#一、BWA-简介" class="headerlink" title="一、BWA 简介"></a>一、BWA 简介</h2><p>BWA，即Burrows-Wheeler-Alignment Tool。<br>BWA 的学习主要来自<a href="http://bio-bwa.sourceforge.net/" target="_blank" rel="external">参考网站</a>和<a href="http://bio-bwa.sourceforge.net/bwa.shtml" target="_blank" rel="external">使用手册</a>；BWA 是一种能够将差异度较小的序列比对到一个较大的参考基因组上的软件包。它由三个不同的算法：<br><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">BWA-backtrack: 是用来比对 Illumina 的序列的，reads 长度最长能到 100bp。</span><br><span class="line">BWA-SW: 用于比对<span class="built_in"> long-read </span>，支持的长度为 70bp-1Mbp；同时支持剪接性比对。</span><br><span class="line">BWA-MEM: 都支持较长的read长度，同时都支持剪接性比对（split alignments)，但是BWA-MEM是更新的算法，也更快，更准确，且 BWA-MEM 对于 70bp-100bp 的 Illumina 数据来说，效果也更好些。</span><br></pre></td></tr></table></figure></p>
<h2 id="二、-BWA-下载和安装"><a href="#二、-BWA-下载和安装" class="headerlink" title="二、 BWA 下载和安装"></a>二、 BWA 下载和安装</h2><p>下载地址：<a href="https://sourceforge.net/projects/bio-bwa/files/" target="_blank" rel="external">sourceforge download</a><br><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">$</span> wget http:<span class="comment">//superb-sea2.dl.sourceforge.net/project/bio-bwa/bwa-0.7.12.tar.bz2</span></span><br><span class="line"><span class="symbol">$</span> tar jxf bwa<span class="number">-0.7</span><span class="number">.12</span>.tar.bz2</span><br><span class="line"><span class="symbol">$</span> cd bwa<span class="number">-0.7</span><span class="number">.12</span></span><br><span class="line"><span class="symbol">$</span> make</span><br><span class="line"><span class="symbol">$</span> echo <span class="string">'PATH=$PATH:/your/bwa/path'</span> &gt;&gt; ~/.bashrc</span><br><span class="line"><span class="symbol">$</span> source ~/.bashrc</span><br></pre></td></tr></table></figure></p>
<h2 id="三、-BWA-使用"><a href="#三、-BWA-使用" class="headerlink" title="三、 BWA 使用"></a>三、 BWA 使用</h2><p>在运用这三种算法之前，需要利用 BWA 的 index 命令，构建出参考基因组的 FM-index，而对与上述的三种不同的算法而言，又有不同的命令：<br><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">aln</span>/samse/sampe ----&gt;</span> BWA-backtrack   (samse 中的 se 是 single-end 的简写，而 sampe 中的 pe 是 paired-end 的简写）。</span><br><span class="line"><span class="function"><span class="title">bwasw</span> ----&gt;</span> BWA-SW</span><br><span class="line"><span class="function"><span class="title">mem</span> ----&gt;</span> BWA-MEM</span><br></pre></td></tr></table></figure></p>
<h3 id="3-1-建立索引-index"><a href="#3-1-建立索引-index" class="headerlink" title="3.1 建立索引 index"></a>3.1 建立索引 index</h3><p>在进行 reads 的比对前，需要对 fasta 文件构建 FM-index。<br>用法和参数如下：<br><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">index</span>   Usage：bwa <span class="keyword">index</span> [ –p prefix ] [ –a algoType ] &lt;<span class="keyword">in</span>.db.fasta&gt;</span><br><span class="line">        <span class="keyword">Index</span> database <span class="keyword">sequence</span> <span class="keyword">in</span> the FASTA format.</span><br><span class="line">        OPTIONS:</span><br><span class="line">        -P STR  输出数据库的前缀；【默认和输入的文件名一致，输出的数据库在其输入文件所在的文件夹，并以该文件名为前缀。】</span><br><span class="line">        -a [<span class="keyword">is</span>|bwtsw]   构建<span class="keyword">index</span>的算法，有两个算法：</span><br><span class="line">                        <span class="keyword">is</span>  是默认的算法，虽然相对较快，但是需要较大的内存，当构建的数据库大于<span class="number">2</span>GB的时候就不能正常工作了。</span><br><span class="line">                        bwtsw   对于短的参考序列式不工作的，必须要大于等于<span class="number">10</span>MB, 但能用于较大的基因组数据，比如人的全基因组。</span><br></pre></td></tr></table></figure></p>
<p>根据reference genome data(e.g. ref.fa) 建立 Index File例子：<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ bwa index ref<span class="selector-class">.fa</span> -<span class="selector-tag">p</span> genome</span><br><span class="line">###可以不加-<span class="selector-tag">p</span> genome，这样建立索引都是以ref.fa为前缀,以下使用的示例均未使用-<span class="selector-tag">p</span> genome###</span><br></pre></td></tr></table></figure></p>
<h3 id="3-2-mem比对"><a href="#3-2-mem比对" class="headerlink" title="3.2 mem比对"></a>3.2 mem比对</h3><p>该算法先使用 MEM(maximal exact matches) 进行 seeding alignments，再使用 SW(affine-gap Smith-Waterman) 算法进行 seeds 的延伸。<br>BWA–MEM 算法执行局部比对和剪接性。可能会出现 query 序列的多个不同的部位出现各自的最优匹配，导致 reads 有多个最佳匹配位点。这对 long reads 的比对时比较重要的结果。但是却会和 Picard 的 markDuplicates 程序部兼容。<br>使用方法如下：<br><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mem Usage: bwa mem [options] ref.fa reads.f<span class="string">q [mates.fq]</span></span><br></pre></td></tr></table></figure></p>
<p>简单的来讲，mem 使用的 MEMs(maximal exact matches） 进行seedling alignments, 再使用 SW(affine-gap Smith-Waterman 算法）进行seeding extending.<br>mem 进行局部比对，因此，对于一条序列的不同区域可能会产生多种最优匹配结果， 这对于long reads 来说尤为重要。 有些软件如 Picard’s markDuplicates 跟 mem 的这种剪接性比对不兼容,<br>在这种情况下，可以使用 –M 选项来将 shorter split hits 标记为次优。<br>特别说明：<br>如果 mates.fq 缺省，且参数 –p 未设定，那么 reads.fq 被认为是 single-end;<br>如果 mates.fq 存在，且参数 –p 未设定，那么 mem 命令会认为 read.fq 和 mates.fq 中的  i-th reads 组成一个read对 (a read pair)，这个模式是常用的 paired-end mode。<br>如果参数 –p 被设定，那么， mem 命令会认为 read.fq 中的 第 2i-th 和 第 (2i + 1)-th 的 reads 组成一个 read 对 （a read pair），这种方式也被成为交错式的（interleaved paired-end)。 在这种情况下，即使有 mates.fq，也会被忽略。<br>常用的参数如下：<br><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-<span class="ruby">t INT  线程数，默认是<span class="number">1</span>。</span><br><span class="line"></span>-<span class="ruby">M      将 shorter split hits 标记为次优，以兼容 Picard’s markDuplicates 软件。</span><br><span class="line"></span>-<span class="ruby">p      若无此参数：输入文件只有<span class="number">1</span>个，则进行单端比对；若输入文件有<span class="number">2</span>个，则作为paired reads进行比对。若加入此参数：则仅以第<span class="number">1</span>个文件作为输入(输入的文件若有<span class="number">2</span>个，则忽略之)，该文件必须是read1.fq和read2.fa进行reads交叉的数据。</span><br><span class="line"></span>-<span class="ruby">R STR  完整的read group的头部，可以用 <span class="string">'\t'</span> 作为分隔符， 在输出的SAM文件中被解释为制表符TAB. read group 的ID，会被添加到输出文件的每一个read的头部。</span><br><span class="line"></span>-<span class="ruby">T INT  当比对的分值比 INT 小时，不输出该比对结果，这个参数只影响输出的结果，不影响比对的过程。</span><br><span class="line"></span>-<span class="ruby">a      将所有的比对结果都输出，包括 single-<span class="keyword">end</span> 和 unpaired paired-<span class="keyword">end</span>的 reads，但是这些比对的结果会被标记为次优。</span></span><br></pre></td></tr></table></figure></p>
<p>例子：<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ bwa mem ref<span class="selector-class">.fa</span> reads<span class="selector-class">.fq</span> &gt; mem-se<span class="selector-class">.sam</span></span><br><span class="line">$ bwa mem ref<span class="selector-class">.fa</span> read1<span class="selector-class">.fq</span> read2<span class="selector-class">.fq</span> &gt; mem-pe<span class="selector-class">.sam</span></span><br><span class="line">$ bwa mem -t <span class="number">4</span> -M -R <span class="string">"\@RG\tID:&#123;library&#125;\tLB:&#123;library&#125;\tPL:Illumina\tPU:&#123;sample&#125;\tSM:&#123;sample&#125;\"  ref.fa read1.fastq read2.fastq &gt; mem-pe.sam 2&gt; ./mem-pe.log</span></span><br></pre></td></tr></table></figure></p>
<h3 id="3-3-align-samse-sampe"><a href="#3-3-align-samse-sampe" class="headerlink" title="3.3 align/samse/sampe"></a>3.3 align/samse/sampe</h3><p>用法如下：<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">对于single-read：</span><br><span class="line">bwa aln [options] ref<span class="selector-class">.fa</span> read<span class="selector-class">.fq</span> &gt; aln_sa<span class="selector-class">.sai</span></span><br><span class="line">bwa samse [options] ref<span class="selector-class">.fa</span> aln_sa<span class="selector-class">.sai</span> read<span class="selector-class">.fq</span> &gt; aln-se<span class="selector-class">.sam</span></span><br><span class="line">对于pair-reads：</span><br><span class="line">bwa aln [options] ref<span class="selector-class">.fa</span> read1<span class="selector-class">.fq</span> &gt; aln_sa1<span class="selector-class">.sai</span></span><br><span class="line">bwa aln [options] ref<span class="selector-class">.fa</span> read2<span class="selector-class">.fq</span> &gt; aln_sa2<span class="selector-class">.sai</span></span><br><span class="line">bwa sampe [options] ref<span class="selector-class">.fa</span> aln_sa1<span class="selector-class">.sai</span> aln_sa2<span class="selector-class">.sai</span> read1<span class="selector-class">.fq</span> read2<span class="selector-class">.fq</span> &gt; aln-pe.sam</span><br></pre></td></tr></table></figure></p>
<h3 id="3-4-bwasw"><a href="#3-4-bwasw" class="headerlink" title="3.4 bwasw"></a>3.4 bwasw</h3><p>对输入的第1个文件的所有序列进行比对。如果输如有 2 个文件，则进行 paired-end 比对，此模式仅对 Illumina 的 short-insert 数据进行比对。在 Paired-end 模式下，BWA-SW依然输出剪接性比对结果，但是这些结果会标记为 not properly paired; 同时如果有多个匹配位点，则不会写入 mate 的匹配位置。<br>常用参数如下：<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bwasw   </span><br><span class="line">Usage: bwa bwasw [ options ] ref<span class="selector-class">.fasta</span> reads<span class="selector-class">.fq</span> [mate.fq] &gt; aln<span class="selector-class">.sam</span></span><br><span class="line">-t  INT 使用的线程数</span><br></pre></td></tr></table></figure></p>
<p>例子：<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ bwa bwasw genome long_read<span class="selector-class">.fq</span> &gt; aln<span class="selector-class">.sam</span></span><br><span class="line">$ bwa bwasw genome read1<span class="selector-class">.fq</span> read2<span class="selector-class">.fq</span> &gt; aln-pe.sam</span><br></pre></td></tr></table></figure></p>
<h3 id="3-5-backtrack"><a href="#3-5-backtrack" class="headerlink" title="3.5 backtrack"></a>3.5 backtrack</h3><p>经典的 bwa 先使用 aln 命令将单独的 reads 比对到参考序列，再使用 samse 或 sampe 生成 sam 文件。<br>常用例子：<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ bwa aln genome read1<span class="selector-class">.fq</span> &gt; aln_sa1<span class="selector-class">.sai</span></span><br><span class="line">$ bwa aln genome read2<span class="selector-class">.fq</span> &gt; aln_sa2<span class="selector-class">.sai</span></span><br><span class="line">$ bwa samse genome aln_sa1<span class="selector-class">.sai</span> read1<span class="selector-class">.fq</span> &gt; aln_se<span class="selector-class">.sam</span></span><br><span class="line">$ bwa sampe genome aln_sa1<span class="selector-class">.sai</span> aln_sa2<span class="selector-class">.sai</span> read1<span class="selector-class">.fq</span> read2<span class="selector-class">.fq</span> &gt; aln_pe.sam</span><br></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Jellyfish详解]]></title>
      <url>http://yoursite.com/2016/05/22/Jellyfish%E8%AF%A6%E8%A7%A3/</url>
      <content type="html"><![CDATA[<h2 id="一、Jellyfish简介"><a href="#一、Jellyfish简介" class="headerlink" title="一、Jellyfish简介"></a>一、Jellyfish简介</h2><p><a href="http://www.cbcb.umd.edu/software/jellyfish/" target="_blank" rel="external">JELLYFISH</a>是<a href="http://www.cbcb.umd.edu/" target="_blank" rel="external">CBCB(Center for Bioinformatics and Computational Biology)</a>的Guillaume Marçais 和 <a href="http://www.cs.cmu.edu/~ckingsf/" target="_blank" rel="external">Carl Kingsford</a> 研发的一款计数 DNA 的 k-mers 的软件。该软件运用 Hash 表来存储数据，同时能多线程运行，速度快，内存消耗小。该软件只能运行在64位的Linux系统下。其<a href="http://bioinformatics.oxfordjournals.org/content/27/6/764" target="_blank" rel="external">文章</a>于2011年发表在杂志 <a href="http://bioinformatics.oxfordjournals.org/" target="_blank" rel="external">Bioinformatics</a> 上。</p>
<h2 id="二、Jellyfish安装"><a href="#二、Jellyfish安装" class="headerlink" title="二、Jellyfish安装"></a>二、Jellyfish安装</h2><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>wget <span class="symbol">http:</span>/<span class="regexp">/www.cbcb.umd.edu/software</span><span class="regexp">/jellyfish/jellyfish</span>-<span class="number">1.1</span>.<span class="number">10</span>.tar.gz</span><br><span class="line"><span class="variable">$ </span>tar zxvf jellyfish-<span class="number">1.1</span>.<span class="number">10</span>.tar.gz</span><br><span class="line"><span class="variable">$ </span>mkdir jellyfish</span><br><span class="line"><span class="variable">$ </span>cd jellyfish-<span class="number">1.1</span>.<span class="number">10</span></span><br><span class="line"><span class="variable">$ </span>./configure --prefix=Your/Path/to/jellyfish</span><br><span class="line">如果安装在当前目录中，会报错。</span><br><span class="line"><span class="variable">$ </span>make -j <span class="number">8</span></span><br><span class="line"><span class="variable">$ </span>make install</span><br></pre></td></tr></table></figure>
<h2 id="三、Jellyfish的使用"><a href="#三、Jellyfish的使用" class="headerlink" title="三、Jellyfish的使用"></a>三、Jellyfish的使用</h2><h3 id="1-jellyfish的使用方法"><a href="#1-jellyfish的使用方法" class="headerlink" title="1. jellyfish的使用方法"></a>1. jellyfish的使用方法</h3><p>jellyfish的功能有：kmer计数；融合二进制的Hash结果；统计Hash结果；通过Hash结果来画直方图；将Hash结果输出成文本格式；查询指定k-mer的数目。<br><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">jellyfish </span><span class="built_in">count</span> [-o <span class="keyword">prefix] </span>[-m merlength] [-t threads] [-s hashsize] [--<span class="keyword">both-strands] </span>fasta [fasta ...]</span><br><span class="line">$ <span class="keyword">jellyfish </span>merge hash1 hash2 ...</span><br><span class="line">$ <span class="keyword">jellyfish </span>dump hash</span><br><span class="line">$ <span class="keyword">jellyfish </span>stats hash</span><br><span class="line">$ <span class="keyword">jellyfish </span>histo [-h high] [-l low] [-i increment] hash</span><br><span class="line">$ <span class="keyword">jellyfish </span>query hash</span><br><span class="line">$ <span class="keyword">jellyfish </span>cite</span><br></pre></td></tr></table></figure></p>
<h3 id="2-k-mer的计数"><a href="#2-k-mer的计数" class="headerlink" title="2. k-mer的计数"></a>2. k-mer的计数</h3><p>使用count的命令来执行计数功能，例子：<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ jellyfish count -m <span class="number">16</span> -s <span class="number">100</span>M -t <span class="number">24</span> -o mer_counts -c <span class="number">7</span> <span class="selector-tag">input</span><span class="selector-class">.fastq</span></span><br><span class="line">使用fastq文件在默认参数上和fasta文件没有区别。生成的hash结果为二进制文件。</span><br></pre></td></tr></table></figure></p>
<p>常用参数：<br><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">-<span class="ruby">m <span class="params">| --mer-len=&lt;num&gt;</span><br><span class="line"></span></span>    使用的k-mer的长度。如果基因组大小为G，则k-mer长度选择为: k ~= log(200G)</span><br><span class="line"><span class="comment">/log(4)。</span></span><br><span class="line">-<span class="ruby"><span class="params">s |</span> --size=&lt;num&gt;</span><br><span class="line"></span>    Hash 的大小。最好设置的值大于总的独特的(distinct)k-mer数,这样生成的文件只</span><br><span class="line">有一个。若该值不够大，则会生成多个hash文件，以数字区分文件名。如果基因组大小为G，每</span><br><span class="line">个reads有一个错误，总共有n条reads，则该值可以设置为『(G + k*n)/0.8』。该值识别 </span><br><span class="line">M 和 G。</span><br><span class="line">-<span class="ruby">t <span class="params">| --threads=&lt;num&gt;  default: 1</span><br><span class="line"></span></span>    使用的CPU线程数</span><br><span class="line">-<span class="ruby"><span class="params">o |</span> --output=&lt;string&gt;  <span class="symbol">default:</span> mer_counts</span><br><span class="line"></span>    输出的结果文件前缀</span><br><span class="line">-<span class="ruby">c <span class="params">| --counter-len=&lt;num&gt;  default:7</span><br><span class="line"></span></span>    k-mer的计数结果所占的比特数,默认支持的最大数字是2^7=128。对于基因组测序覆盖</span><br><span class="line">度为N，则要使设置的该值要大于N。该值越大，消耗内存越大。例如，如果基因组的覆盖度为10X，那么就要选择4(-c 4) 的counter长度，由于2^4 &gt; 10。</span><br><span class="line">-<span class="ruby"><span class="params">out-counter-len=&lt;num&gt;  default:4</span><br><span class="line"></span></span>    输出的二进制hash文件中的计数结果所占的字节数,一个字节是8比特。则默认支持的最大</span><br><span class="line">数字是2^32=4.3G</span><br><span class="line">-<span class="ruby"><span class="params">C |</span> --both-strand  <span class="symbol">default:</span> <span class="literal">false</span></span><br><span class="line"></span>    对正义链和反义链都进行计数</span><br><span class="line">-<span class="ruby">q <span class="params">| --quake  default: <span class="literal">false</span></span><br><span class="line"></span></span>    quake兼容模式</span><br><span class="line">-<span class="ruby"><span class="params">-quality-start=&lt;num&gt;  default: 64</span><br><span class="line"></span></span>    起始碱基质量的ASCII值，默认为PHRED64</span><br><span class="line">-<span class="ruby"><span class="params">-min-quality=&lt;num&gt;  default: 0</span><br><span class="line"></span></span>    支持的最小的碱基质量值，低于此值的碱基将由N代替</span><br><span class="line">-<span class="ruby"><span class="params">L |</span> --lower-count=&lt;num&gt;</span><br><span class="line"></span>    不输出数目低于此值的k-mer</span><br><span class="line">-<span class="ruby">U <span class="params">| --upper-count=&lt;num&gt;</span><br><span class="line"></span></span>    不输出数目高于此值的k-mer</span><br></pre></td></tr></table></figure></p>
<h3 id="3-融合二进制的输出结果"><a href="#3-融合二进制的输出结果" class="headerlink" title="3. 融合二进制的输出结果"></a>3. 融合二进制的输出结果</h3><p>上一步的输出结果为二进制文件，可能输出了多个hash文件，因此需要将这些hash文件合并成一个文件，此时用到 merge 命令。使用方法：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ jellyfish merge -o mer_counts_merged.jf <span class="built_in">hash</span>1 <span class="built_in">hash</span>2 ...</span><br></pre></td></tr></table></figure></p>
<p>常用参数：<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-<span class="keyword">o</span> | --output=<span class="symbol">&lt;string&gt;</span>  defaul<span class="variable">t:</span> mer_counts_merged.jf</span><br><span class="line">    输出的结果文件</span><br><span class="line">--out-counter-<span class="built_in">len</span>=<span class="symbol">&lt;num&gt;</span>  defaul<span class="variable">t:</span> <span class="number">4</span></span><br><span class="line">输出的二进制hash文件中的计数结果所占的字节数,一个字节是<span class="number">8</span>比特。则默认支持的最大数字</span><br><span class="line">是<span class="number">2</span>^<span class="number">32</span>=<span class="number">4.3</span>G</span><br></pre></td></tr></table></figure></p>
<h3 id="4-对hash结果进行统计"><a href="#4-对hash结果进行统计" class="headerlink" title="4. 对hash结果进行统计"></a>4. 对hash结果进行统计</h3><p>k-mer的结果以hash的二进制文件结果给出，需要统计出k-mer总数，特异的k-mer数目，只出现过一次的kmer数，出现了最多的k-mer的数目等信息。以stats命令来运行。使用方法：<br><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ jellyfish stats hash</span><br><span class="line">示例结果为：</span><br><span class="line"><span class="symbol">Unique:</span>    <span class="number">32355544</span>    <span class="meta">#只出现过一次的k-mer的数目</span></span><br><span class="line"><span class="symbol">Distinct:</span>  <span class="number">88414020</span>    <span class="meta">#特异性的k-mer数目，包含上一个的数据</span></span><br><span class="line"><span class="symbol">Total:</span>     <span class="number">432232807</span>   <span class="meta">#总的k-mer数目</span></span><br><span class="line"><span class="symbol">Max_count:</span> <span class="number">85348</span>       <span class="meta">#同一个k-mer出现的最多的数目</span></span><br></pre></td></tr></table></figure></p>
<p>常用参数：<br><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-<span class="ruby">L <span class="params">| --lower-count=&lt;num&gt;</span><br><span class="line"></span></span>    不统计数目低于此值的k-mer</span><br><span class="line">-<span class="ruby"><span class="params">U |</span> --upper-count=&lt;num&gt;</span><br><span class="line"></span>    不统计数目高于此值的k-mer</span><br></pre></td></tr></table></figure></p>
<h3 id="5-通过Hash结果来画直方图"><a href="#5-通过Hash结果来画直方图" class="headerlink" title="5. 通过Hash结果来画直方图"></a>5. 通过Hash结果来画直方图</h3><p>对k-mer的计数结果有个直观的认识，则需要统计出现了x(x=1,2,3…)次的kmer的数目y,以x，y为横纵坐标画出直方图。使用 histo 命令能给出 x 和 y 对应的值，将结果默认输出到标准输出。其使用方法为<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ jellyfish histo <span class="_">-l</span> 1 -h 1000 <span class="built_in">hash</span></span><br></pre></td></tr></table></figure></p>
<p>常用参数：<br><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">-<span class="ruby">l <span class="params">| --low=&lt;num&gt;  default: 1</span><br><span class="line"></span></span>    最低的 x 轴的值。同时结果会将低于此值的所有的k-mer的数目作为 (x-1) 的值。因</span><br><span class="line">此该值为 2 和 1 的结果是一致的。</span><br><span class="line">-<span class="ruby"><span class="params">h |</span> --high=&lt;num&gt;  <span class="symbol">default:</span> <span class="number">10000</span></span><br><span class="line"></span>    最高的 x 轴的值。同时结果会将高于此值的所有的k-mer的数目的和作为 (x+1) 的值。</span><br><span class="line">-<span class="ruby">i <span class="params">| --increment=&lt;num&gt;  default: 1</span><br><span class="line"></span></span>    x 轴取值是每隔该数值取值</span><br><span class="line">-<span class="ruby"><span class="params">t |</span> --threads=&lt;num&gt;  <span class="symbol">default:</span> <span class="number">1</span></span><br><span class="line"></span>    使用的CPU线程数</span><br><span class="line">-<span class="ruby">f <span class="params">| --full  default: <span class="literal">false</span></span><br><span class="line"></span></span>    全部的直方图</span><br></pre></td></tr></table></figure></p>
<h3 id="6-将二进制Hash结果转换成文本文件"><a href="#6-将二进制Hash结果转换成文本文件" class="headerlink" title="6. 将二进制Hash结果转换成文本文件"></a>6. 将二进制Hash结果转换成文本文件</h3><p>由于count命令生成的结果为二进制的，如有需要，则可以转换成可读文本文件。使用 dump 命令，使用方法：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ jellyfish <span class="built_in">dump</span> -<span class="built_in">c</span> -t -<span class="type">U</span> <span class="number">1000</span> hash</span><br></pre></td></tr></table></figure></p>
<p>常用参数：<br><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">-<span class="ruby">c <span class="params">| --colum  default: <span class="literal">false</span></span><br><span class="line"></span></span>    生成结果为2列，第一列为k-mer序列，第二列为对应的数目。默认情况下是是fasta格</span><br><span class="line">式，fasta的头为k-mer的数目，fasta的序列为k-mer的序列。</span><br><span class="line">-<span class="ruby"><span class="params">t |</span> --tab  <span class="symbol">default:</span> <span class="literal">false</span></span><br><span class="line"></span>    当 -c 参数存在时，以tab来进行分隔两行。默认是以空格来分开的。</span><br><span class="line">-<span class="ruby">L <span class="params">| --lower-count=&lt;num&gt;</span><br><span class="line"></span></span>    不输出小于该值的k-mer</span><br><span class="line">-<span class="ruby"><span class="params">U |</span> --upper-count=&lt;num&gt;</span><br><span class="line"></span>    不输出高于该值的k-mer</span><br><span class="line">-<span class="ruby">o <span class="params">| --output=&lt;file&gt;</span><br><span class="line"></span></span>    输出文件的路径和名称</span><br></pre></td></tr></table></figure></p>
<h3 id="7-查询指定的k-mer出现的次数"><a href="#7-查询指定的k-mer出现的次数" class="headerlink" title="7. 查询指定的k-mer出现的次数"></a>7. 查询指定的k-mer出现的次数</h3><p>如果需要从Hash结果中查询指定的k-mer出现的次数，则要是用 query 命令。从标准输入读取k-mer的序列，从标准输出得到k-mer对应的数目。使用方法<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ jellyfish query <span class="built_in">hash</span></span><br></pre></td></tr></table></figure></p>
<p>常用参数：<br><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-<span class="ruby">C <span class="params">| --both-strands  default: <span class="literal">false</span></span><br><span class="line"></span></span>    同时查询k-mer序列的正负链</span><br><span class="line">-<span class="ruby"><span class="params">i |</span> --input=&lt;file&gt;</span><br><span class="line"></span>    输入的文件</span><br><span class="line">-<span class="ruby">o <span class="params">| --output=&lt;file&gt;</span><br><span class="line"></span></span>    输出的文件</span><br></pre></td></tr></table></figure></p>
<h2 id="四、思考"><a href="#四、思考" class="headerlink" title="四、思考"></a>四、思考</h2><h3 id="对Illumina-paired-end测序结果进行jellyfish分析"><a href="#对Illumina-paired-end测序结果进行jellyfish分析" class="headerlink" title="对Illumina paired-end测序结果进行jellyfish分析"></a>对Illumina paired-end测序结果进行jellyfish分析</h3><p>由于paired-end序列有一定的顺序，需要将第2个文件的序列进行反向重复后，在和第一个文件的序列合到一起进行分析。可以使用Trinity中附带的软件fastool来将fastq文件转换成fasta文件，以及反向重复的转换。<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="variable">$Trinity_Home</span>/trinity-plugins/fastool/fastool --illumina-trinity --to-fasta reads_1<span class="selector-class">.fastaq</span> &gt; reads_1<span class="selector-class">.fasta</span></span><br><span class="line">$ <span class="variable">$Trinity_Home</span>/trinity-plugins/fastool/fastool --rev --illumina-trinity --to-fasta reads_2<span class="selector-class">.fastaq</span> &gt; reads_2<span class="selector-class">.fasta</span></span><br><span class="line">$ cat reads_1<span class="selector-class">.fasta</span> reads_2<span class="selector-class">.fasta</span> &gt; both<span class="selector-class">.fasta</span></span><br><span class="line">$ jellyfish count ....</span><br></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Samtools常用命令详解]]></title>
      <url>http://yoursite.com/2016/05/21/Samtools%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E8%AF%A6%E8%A7%A3/</url>
      <content type="html"><![CDATA[<p>samtools的说明文档：<a href="http://samtools.sourceforge.net/samtools.shtml" target="_blank" rel="external">http://samtools.sourceforge.net/samtools.shtml</a><br>samtools是一个用于操作sam和bam文件的工具合集。包含有许多命令。以下是常用命令的介绍</p>
<h2 id="1-view"><a href="#1-view" class="headerlink" title="1. view"></a>1. view</h2><p>view命令的主要功能是：将sam文件转换成bam文件；然后对bam文件进行各种操作，比如数据的排序(不属于本命令的功能)和提取(这些操作是对bam文件进行的，因而当输入为sam文件的时候，不能进行该操作)；最后将排序或提取得到的数据输出为bam或sam（默认的）格式。</p>
<p>bam文件优点：bam文件为二进制文件，占用的磁盘空间比sam文本文件小；利用bam二进制文件的运算速度快。</p>
<p>view命令中，对sam文件头部的输入(-t或-T）和输出(-h)是单独的一些参数来控制的</p>
<figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">Usage: samtools view [options] &lt;in.bam&gt;|&lt;in.sam&gt; [region1 [...]]</span><br><span class="line">默认情况下不加 region，则是输出所有的 region.</span><br><span class="line"></span><br><span class="line">Options: -b       output BAM</span><br><span class="line">                  默认下输出是 SAM 格式文件，该参数设置输出 BAM 格式</span><br><span class="line">         -<span class="ruby">h       print header <span class="keyword">for</span> the SAM output</span><br><span class="line"></span>                  默认下输出的 sam 格式文件不带 header，该参数设定输出sam文件时带 header 信息</span><br><span class="line">         -<span class="ruby">H       print header only (no alignments)</span><br><span class="line"></span>         -<span class="ruby">S       input is SAM</span><br><span class="line"></span>                  默认下输入是 BAM 文件，若是输入是 SAM 文件，则最好加该参数，否则有时候会报错。</span><br><span class="line">         -<span class="ruby">u       uncompressed BAM output (force -b)</span><br><span class="line"></span>                  该参数的使用需要有-b参数，能节约时间，但是需要更多磁盘空间。</span><br><span class="line">         -<span class="ruby">c       Instead of printing the alignments, only count them <span class="keyword">and</span> print the </span><br><span class="line"></span>                  total number. All filter options, such as ‘-f’, ‘-F’ and ‘-q’ , </span><br><span class="line">                  are taken into account.</span><br><span class="line">         -<span class="ruby"><span class="number">1</span>       fast compression (force -b)</span><br><span class="line"></span>         -<span class="ruby">x       output FLAG <span class="keyword">in</span> HEX (samtools-C specific)</span><br><span class="line"></span>         -<span class="ruby">X       output FLAG <span class="keyword">in</span> string (samtools-C specific)</span><br><span class="line"></span>         -<span class="ruby">c       print only the count of matching records</span><br><span class="line"></span>         -<span class="ruby">L FILE  output alignments overlapping the input BED FILE [null]</span><br><span class="line"></span>         -<span class="ruby">t FILE  list of reference names <span class="keyword">and</span> lengths (force -S) [null]</span><br><span class="line"></span>                  使用一个list文件来作为header的输入</span><br><span class="line">         -<span class="ruby">T FILE  reference sequence file (force -S) [null]</span><br><span class="line"></span>                  使用序列fasta文件作为header的输入</span><br><span class="line">         -<span class="ruby">o FILE  output file name [stdout]</span><br><span class="line"></span>         -<span class="ruby">R FILE  list of read groups to be outputted [null]</span><br><span class="line"></span>         -<span class="ruby">f INT   required flag, <span class="number">0</span> <span class="keyword">for</span> unset [<span class="number">0</span>]</span><br><span class="line"></span>         -<span class="ruby">F INT   filtering flag, <span class="number">0</span> <span class="keyword">for</span> unset [<span class="number">0</span>] </span><br><span class="line"></span>                  Skip alignments with bits present in INT [0]</span><br><span class="line">                  数字4代表该序列没有比对到参考序列上</span><br><span class="line">                  数字8代表该序列的mate序列没有比对到参考序列上</span><br><span class="line">         -<span class="ruby">q INT   minimum mapping quality [<span class="number">0</span>]</span><br><span class="line"></span>         -<span class="ruby">l STR   only output reads <span class="keyword">in</span> library STR [null]</span><br><span class="line"></span>         -<span class="ruby">r STR   only output reads <span class="keyword">in</span> read group STR [null]</span><br><span class="line"></span>         -<span class="ruby">s FLOAT fraction of templates to subsample; integer part as seed [-<span class="number">1</span>]</span><br><span class="line"></span>         -<span class="ruby">?       longer help</span></span><br></pre></td></tr></table></figure>
<p>例子：</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">将sam文件转换成<span class="keyword">bam文件</span><br><span class="line"></span>$ samtools view -<span class="keyword">bS </span>abc.sam &gt; abc.<span class="keyword">bam</span><br><span class="line"></span>$ samtools view -<span class="keyword">b </span>-S abc.sam -o abc.<span class="keyword">bam</span><br><span class="line"></span></span><br><span class="line">提取比对到参考序列上的比对结果</span><br><span class="line">$ samtools view -<span class="keyword">bF </span><span class="number">4</span> abc.<span class="keyword">bam </span>&gt; abc.F.<span class="keyword">bam</span><br><span class="line"></span></span><br><span class="line">提取paired reads中两条reads都比对到参考序列上的比对结果，只需要把两个<span class="number">4</span>+<span class="number">8</span>的值<span class="number">12</span>作为过滤参数即可</span><br><span class="line">$ samtools view -<span class="keyword">bF </span><span class="number">12</span> abc.<span class="keyword">bam </span>&gt; abc.F12.<span class="keyword">bam</span><br><span class="line"></span></span><br><span class="line">提取没有比对到参考序列上的比对结果</span><br><span class="line">$ samtools view -<span class="keyword">bf </span><span class="number">4</span> abc.<span class="keyword">bam </span>&gt; abc.f.<span class="keyword">bam</span><br><span class="line"></span></span><br><span class="line">提取<span class="keyword">bam文件中比对到caffold1上的比对结果，并保存到sam文件格式</span><br><span class="line"></span>$ samtools view abc.<span class="keyword">bam </span><span class="keyword">scaffold1 </span>&gt; <span class="keyword">scaffold1.sam</span><br><span class="line"></span></span><br><span class="line">提取<span class="keyword">scaffold1上能比对到30k到100k区域的比对结果</span><br><span class="line"></span>$ samtools view abc.<span class="keyword">bam </span><span class="keyword">scaffold1:30000-100000 </span>$gt<span class="comment">; scaffold1_30k-100k.sam</span></span><br><span class="line"></span><br><span class="line">根据fasta文件，将 header 加入到 sam 或 <span class="keyword">bam </span>文件中</span><br><span class="line">$ samtools view -T genome.fasta -h <span class="keyword">scaffold1.sam </span>&gt; <span class="keyword">scaffold1.h.sam</span></span><br></pre></td></tr></table></figure>
<h2 id="2-sort"><a href="#2-sort" class="headerlink" title="2. sort"></a>2. sort</h2><p>sort对bam文件进行排序<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">Usage</span>: <span class="selector-tag">samtools</span> <span class="selector-tag">sort</span> <span class="selector-attr">[-n]</span> <span class="selector-attr">[-m &lt;maxMem&gt;]</span> &lt;<span class="selector-tag">in</span><span class="selector-class">.bam</span>&gt; &lt;<span class="selector-tag">out</span><span class="selector-class">.prefix</span>&gt;  </span><br><span class="line"><span class="selector-tag">-m</span> 参数默认下是 500,000,000 即500<span class="selector-tag">M</span>（不支持<span class="selector-tag">K</span>，<span class="selector-tag">M</span>，<span class="selector-tag">G</span>等缩写）。对于处理大数据时，如果内存够用，则设置大点的值，以节约时间。</span><br><span class="line"><span class="selector-tag">-n</span> 设定排序方式按<span class="selector-tag">short</span> <span class="selector-tag">reads</span>的<span class="selector-tag">ID</span>排序。默认下是按序列在<span class="selector-tag">fasta</span>文件中的顺序（即<span class="selector-tag">header</span>）和序列从左往右的位点排序。</span><br></pre></td></tr></table></figure></p>
<h2 id="3-merge"><a href="#3-merge" class="headerlink" title="3. merge"></a>3. merge</h2><p>将2个或2个以上的已经sort了的bam文件融合成一个bam文件。融合后的文件不需要则是已经sort过了的。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Usage:   samtools <span class="keyword">merge</span> [-nr] [-h inh.sam] &lt;out.bam&gt; &lt;in1.bam&gt; &lt;in2.bam&gt;[...]</span><br><span class="line"></span><br><span class="line">Options: -n       <span class="keyword">sort</span> <span class="keyword">by</span> <span class="keyword">read</span> <span class="keyword">names</span></span><br><span class="line">         -r       attach RG tag (inferred <span class="keyword">from</span> <span class="keyword">file</span> <span class="keyword">names</span>)</span><br><span class="line">         -u       uncompressed BAM <span class="keyword">output</span></span><br><span class="line">         -f       overwrite the <span class="keyword">output</span> BAM <span class="keyword">if</span> exist</span><br><span class="line">         <span class="number">-1</span>       <span class="keyword">compress</span> <span class="keyword">level</span> <span class="number">1</span></span><br><span class="line">         -R <span class="keyword">STR</span>   <span class="keyword">merge</span> <span class="keyword">file</span> <span class="keyword">in</span> the specified region <span class="keyword">STR</span> [all]</span><br><span class="line">         -h <span class="keyword">FILE</span>  copy the header <span class="keyword">in</span> <span class="keyword">FILE</span> <span class="keyword">to</span> &lt;out.bam&gt; [in1.bam]</span><br><span class="line"></span><br><span class="line">Note: Samtools<span class="string">' merge does not reconstruct the @RG dictionary in the header. Users</span><br><span class="line">      must provide the correct header with -h, or uses Picard which properly maintains</span><br><span class="line">      the header dictionary in merging.</span></span><br></pre></td></tr></table></figure></p>
<h2 id="4-index"><a href="#4-index" class="headerlink" title="4. index"></a>4. index</h2><p>必须对bam文件进行默认情况下的排序后，才能进行index。否则会报错。</p>
<p>建立索引后将产生后缀为.bai的文件，用于快速的随机处理。很多情况下需要有bai文件的存在，特别是显示序列比对情况下。比如samtool的tview命令就需要；gbrowse2显示reads的比对图形的时候也需要。<br><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Usage: samtools <span class="keyword">index</span> &lt;<span class="keyword">in</span>.bam&gt; [<span class="keyword">out</span>.<span class="keyword">index</span>]</span><br></pre></td></tr></table></figure></p>
<p>例子：<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">以下两种命令结果一样</span><br><span class="line">$ samtools index abc<span class="selector-class">.sort</span><span class="selector-class">.bam</span></span><br><span class="line">$ samtools index abc<span class="selector-class">.sort</span><span class="selector-class">.bam</span> abc<span class="selector-class">.sort</span><span class="selector-class">.bam</span><span class="selector-class">.bai</span></span><br></pre></td></tr></table></figure></p>
<h2 id="5-faidx"><a href="#5-faidx" class="headerlink" title="5. faidx"></a>5. faidx</h2><p>对fasta文件建立索引,生成的索引文件以.fai后缀结尾。该命令也能依据索引文件快速提取fasta文件中的某一条（子）序列<br><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Usage</span>: samtools faidx &lt;in.bam&gt; [ [...]]</span><br><span class="line"></span><br><span class="line"><span class="stylus">对基因组文件建立索引</span><br><span class="line">$ samtools faidx genome<span class="selector-class">.fasta</span></span><br><span class="line">生成了索引文件genome<span class="selector-class">.fasta</span><span class="selector-class">.fai</span>,是一个文本文件，分成了<span class="number">5</span>列。第一列是子序列的名称；</span><br><span class="line">第二列是子序列的长度；个人认为“第三列是序列所在的位置”，因为该数字从上往下逐渐变大，</span><br><span class="line">最后的数字是genome.fasta文件的大小；第<span class="number">4</span>和<span class="number">5</span>列不知是啥意思。于是通过此文件，可以定</span><br><span class="line">位子序列在fasta文件在磁盘上的存放位置，直接快速调出子序列。</span><br><span class="line"></span><br><span class="line">由于有索引文件，可以使用以下命令很快从基因组中提取到fasta格式的子序列</span><br><span class="line">$ samtools faidx genome<span class="selector-class">.fasta</span> scffold_10 &gt; scaffold_10.fasta</span></span><br></pre></td></tr></table></figure></p>
<h2 id="6-tview"><a href="#6-tview" class="headerlink" title="6. tview"></a>6. tview</h2><p>tview能直观的显示出reads比对基因组的情况，和基因组浏览器有点类似。<br><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Usage</span>: samtools tview &lt;aln.bam&gt; [ref.fasta]</span><br><span class="line"></span><br><span class="line"><span class="mipsasm">当给出参考基因组的时候，会在第一排显示参考基因组的序列，否则，第一排全用N表示。</span><br><span class="line">按下 g ，则提示输入要到达基因组的某一个位点。例子“<span class="keyword">scaffold_10:1000"表示到达第</span><br><span class="line"></span><span class="number">10</span>号<span class="keyword">scaffold的第1000个碱基位点处。</span><br><span class="line"></span>使用H(左）<span class="keyword">J（上）K（下）L（右）移动显示界面。大写字母移动快，小写字母移动慢。</span><br><span class="line"></span>使用空格建向左快速移动（和 L 类似），使用<span class="keyword">Backspace键向左快速移动（和 </span>H 类似）。</span><br><span class="line">Ctrl+H 向左移动<span class="number">1</span>kb碱基距离； Ctrl+L 向右移动<span class="number">1</span>kb碱基距离</span><br><span class="line">可以用颜色标注比对质量，碱基质量，核苷酸等。<span class="number">30</span>～<span class="number">40</span>的碱基质量或比对质量使用白色表示；</span><br><span class="line"><span class="number">20</span>～<span class="number">30</span>黄色；<span class="number">10</span>～<span class="number">20</span>绿色；<span class="number">0</span>～<span class="number">10</span>蓝色。</span><br><span class="line">使用点号<span class="string">'.'</span>切换显示碱基和点号；使用r切换显示read name等</span><br><span class="line">还有很多其它的使用说明，具体按 ？ 键来查看。</span></span><br></pre></td></tr></table></figure></p>
<h2 id="7-flagstat"><a href="#7-flagstat" class="headerlink" title="7. flagstat"></a>7. flagstat</h2><p>给出BAM文件的比对结果<br><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Usage</span>: samtools flagstat &lt;in.bam&gt;</span><br><span class="line"></span><br><span class="line"><span class="elixir"><span class="variable">$ </span>samtools flagstat example.bam</span><br><span class="line"><span class="number">11945742</span> + <span class="number">0</span> <span class="keyword">in</span> total (QC-passed reads + QC-failed reads)</span><br><span class="line"><span class="comment">#总共的reads数</span></span><br><span class="line"><span class="number">0</span> + <span class="number">0</span> duplicates</span><br><span class="line"><span class="number">7536364</span> + <span class="number">0</span> mapped (<span class="number">63.09</span>%<span class="symbol">:-nan%</span>)</span><br><span class="line"><span class="comment">#总体上reads的匹配率</span></span><br><span class="line"><span class="number">11945742</span> + <span class="number">0</span> paired <span class="keyword">in</span> sequencing</span><br><span class="line"><span class="comment">#有多少reads是属于paired reads</span></span><br><span class="line"><span class="number">5972871</span> + <span class="number">0</span> read1</span><br><span class="line"><span class="comment">#reads1中的reads数</span></span><br><span class="line"><span class="number">5972871</span> + <span class="number">0</span> read2</span><br><span class="line"><span class="comment">#reads2中的reads数</span></span><br><span class="line"><span class="number">6412042</span> + <span class="number">0</span> properly paired (<span class="number">53.68</span>%<span class="symbol">:-nan%</span>)</span><br><span class="line"><span class="comment">#完美匹配的reads数：比对到同一条参考序列，并且两条reads之间的距离符合设置的阈值</span></span><br><span class="line"><span class="number">6899708</span> + <span class="number">0</span> with itself <span class="keyword">and</span> mate mapped</span><br><span class="line"><span class="comment">#paired reads中两条都比对到参考序列上的reads数</span></span><br><span class="line"><span class="number">636656</span> + <span class="number">0</span> singletons (<span class="number">5.33</span>%<span class="symbol">:-nan%</span>)</span><br><span class="line"><span class="comment">#单独一条匹配到参考序列上的reads数，和上一个相加，则是总的匹配上的reads数。</span></span><br><span class="line"><span class="number">469868</span> + <span class="number">0</span> with mate mapped to a different chr</span><br><span class="line"><span class="comment">#paired reads中两条分别比对到两条不同的参考序列的reads数</span></span><br><span class="line"><span class="number">243047</span> + <span class="number">0</span> with mate mapped to a different chr (mapQ&gt;=<span class="number">5</span>)</span></span><br></pre></td></tr></table></figure></p>
<p>同上一个，只是其中比对质量&gt;=5的reads的数量</p>
<h2 id="8-depth"><a href="#8-depth" class="headerlink" title="8. depth"></a>8. depth</h2><p>得到每个碱基位点的测序深度,并输出到标准输出。<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">Usage</span>: <span class="selector-tag">bam2depth</span> <span class="selector-attr">[-r reg]</span> <span class="selector-attr">[-q baseQthres]</span> <span class="selector-attr">[-Q mapQthres]</span> <span class="selector-attr">[-b in.bed]</span> &lt;<span class="selector-tag">in1</span><span class="selector-class">.bam</span>&gt; <span class="selector-attr">[...]</span></span><br></pre></td></tr></table></figure></p>
<h2 id="9-其他有用的命令"><a href="#9-其他有用的命令" class="headerlink" title="9. 其他有用的命令"></a>9. 其他有用的命令</h2><p>reheader 替换bam文件的头<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ samtools reheader &lt;<span class="keyword">in</span><span class="selector-class">.header</span><span class="selector-class">.sam</span>&gt; &lt;<span class="keyword">in</span>.bam&gt;</span><br></pre></td></tr></table></figure></p>
<p>cat 连接多个bam文件，适用于非sorted的bam文件<br><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ samtools cat <span class="string">[-h header.sam]</span> <span class="string">[-o out.bam]</span> &lt;in1.bam&gt; &lt;in2.bam&gt; <span class="string">[ ... ]</span></span><br></pre></td></tr></table></figure></p>
<p>idxstats 统计一个表格，4列，分别为”序列名，序列长度，比对上的reads数，unmapped reads number”。第4列应该是paired reads中有一端能匹配到该scaffold上，而另外一端不匹配到任何scaffolds上的reads数。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ samtools idxstats <span class="tag">&lt;<span class="name">aln.bam</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="10-将bam文件转换为fastq文件"><a href="#10-将bam文件转换为fastq文件" class="headerlink" title="10. 将bam文件转换为fastq文件"></a>10. 将bam文件转换为fastq文件</h2><p>有时候，我们需要提取出比对到一段参考序列的reads，进行小范围的分析，以利于debug等。这时需要将bam或sam文件转换为fastq格式。<br>该网站提供了一个bam转换为fastq的程序：<a href="http://www.hudsonalpha.org/gsl/information/software/bam2fastq" target="_blank" rel="external">http://www.hudsonalpha.org/gsl/information/software/bam2fastq</a><br><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">$</span> wget http:<span class="comment">//www.hudsonalpha.org/gsl/static/software/bam2fastq-1.1.0.tgz</span></span><br><span class="line"><span class="symbol">$</span> tar zxf bam2fastq<span class="number">-1.1</span><span class="number">.0</span>.tgz</span><br><span class="line"><span class="symbol">$</span> cd bam2fastq<span class="number">-1.1</span><span class="number">.0</span></span><br><span class="line"><span class="symbol">$</span> make</span><br><span class="line"><span class="symbol">$</span> ./bam2fastq &lt;in.bam&gt;</span><br></pre></td></tr></table></figure></p>
<h2 id="11-mpileup"><a href="#11-mpileup" class="headerlink" title="11. mpileup"></a>11. mpileup</h2><p>samtools还有个非常重要的命令mpileup，以前为pileup。该命令用于生成bcf文件，再使用bcftools进行SNP和Indel的分析。bcftools是samtool中附带的软件，在samtools的安装文件夹中可以找到。</p>
<p>最常用的参数有2： -f 来输入有索引文件的fasta参考序列； -g 输出到bcf格式。用法和最简单的例子如下<br><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Usage: samtools mpileup <span class="comment">[-EBug]</span> <span class="comment">[-C capQcoef]</span> <span class="comment">[-r reg]</span> <span class="comment">[-f in.fa]</span> <span class="comment">[-l list]</span> <span class="comment">[-M capMapQ]</span> <span class="comment">[-Q minBaseQ]</span> <span class="comment">[-q minMapQ]</span> in.bam <span class="comment">[in2.bam <span class="comment">[...]</span>]</span></span><br><span class="line"></span><br><span class="line">$ samtools mpileup -f genome.fasta abc.bam &gt; abc.txt</span><br><span class="line">$ samtools mpileup -gSDf genome.fasta abc.bam &gt; abc.bcf</span><br><span class="line">$ samtools mpileup -guSDf genome.fasta abc.bam | \</span><br><span class="line">           bcftools view -cvNg - &gt; abc.vcf</span><br></pre></td></tr></table></figure></p>
<p>mpileup不使用-u或-g参数时，则不生成二进制的bcf文件，而生成一个文本文件(输出到标准输出)。该文本文件统计了参考序列中每个碱基位点的比对情况；该文件每一行代表了参考序列中某一个碱基位点的比对结果。比如：<br><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">scaffold_1</span></span>      <span class="number">2841</span>    A       <span class="number">11</span>      ,,,...,....     BHIGDGIJ?FF</span><br><span class="line"><span class="function"><span class="title">scaffold_1</span></span>      <span class="number">2842</span>    C       <span class="number">12</span>      ,<span class="symbol">$</span>,,...,....^I. CFGEGEGGCFF+</span><br><span class="line"><span class="function"><span class="title">scaffold_1</span></span>      <span class="number">2843</span>    G       <span class="number">11</span>      ,,...,.....     FDDDDCD?DD+</span><br><span class="line"><span class="function"><span class="title">scaffold_1</span></span>      <span class="number">2844</span>    G       <span class="number">11</span>      ,,...,.....     FA?AAAA&lt;AA+</span><br><span class="line"><span class="function"><span class="title">scaffold_1</span></span>      <span class="number">2845</span>    G       <span class="number">11</span>      ,,...,.....     F656666166*</span><br><span class="line"><span class="function"><span class="title">scaffold_1</span></span>      <span class="number">2846</span>    A       <span class="number">11</span>      ,,...,.....     (<span class="number">1.1111</span>)<span class="number">11</span>*</span><br><span class="line">scaffold_1      <span class="number">2847</span>    A       <span class="number">11</span>      ,,+<span class="number">9</span>acggtgaag.+<span class="number">9</span>ACGGTGAAT.+<span class="number">9</span>ACGGTGAAG.+<span class="number">9</span>ACGGTGAAG,+<span class="number">9</span>acggtgaag.+<span class="number">9</span>ACGGTGAAG.+<span class="number">9</span>ACGGTGAAG.+<span class="number">9</span>ACGGTGAAG.+<span class="number">9</span>ACGGTGAAG.+<span class="number">9</span>ACGGTGAAG       %.+....-..)</span><br><span class="line">scaffold_1      <span class="number">2848</span>    N       <span class="number">11</span>      agGGGgGGGGG     !!<span class="symbol">$</span>!!!!!!!!</span><br><span class="line"><span class="function"><span class="title">scaffold_1</span></span>      <span class="number">2849</span>    A       <span class="number">11</span>      c<span class="symbol">$</span>,...,.....    !<span class="number">0000000000</span></span><br><span class="line"><span class="function"><span class="title">scaffold_1</span></span>      <span class="number">2850</span>    A       <span class="number">10</span>      ,...,.....      <span class="number">353333333</span></span><br></pre></td></tr></table></figure></p>
<p>mpileup生成的结果包含6行：参考序列名；位置；参考碱基；比对上的reads数；比对情况；比对上的碱基的质量。其中第5列比较复杂,解释如下：</p>
<p>1 ‘.’代表与参考序列正链匹配。<br>2 ‘,’代表与参考序列负链匹配。<br>3 ‘ATCGN’代表在正链上的不匹配。<br>4 ‘atcgn’代表在负链上的不匹配。<br>5 ‘*’代表模糊碱基<br>6 ‘^’代表匹配的碱基是一个read的开始；’^’后面紧跟的ascii码减去33代表比对质量；这两个符号修饰的是后面的碱基，其后紧跟的碱基(.,ATCGatcgNn)代表该read的第一个碱基。<br>7 ‘$’代表一个read的结束，该符号修饰的是其前面的碱基。<br>8 正则式’+[0-9]+[ACGTNacgtn]+’代表在该位点后插入的碱基；比如上例中在scaffold_1的2847后插入了9个长度的碱基acggtgaag。表明此处极可能是indel。<br>9 正则式’-[0-9]+[ACGTNacgtn]+’代表在该位点后缺失的碱基；</p>
<p>pileup具体的参数如下：<br><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">输入参数</span><br><span class="line"><span class="number">-6</span>       Assume <span class="keyword">the</span> quality is <span class="keyword">in</span> <span class="keyword">the</span> Illumina <span class="number">1.3</span>+ encoding. -A Do <span class="keyword">not</span> skip anomalous <span class="built_in">read</span> pairs <span class="keyword">in</span> variant calling. </span><br><span class="line">-B       Disable probabilistic realignment <span class="keyword">for</span> <span class="keyword">the</span> computation <span class="keyword">of</span> base alignment quality (BAQ). BAQ is <span class="keyword">the</span> Phred-scaled probability <span class="keyword">of</span> <span class="keyword">a</span> <span class="built_in">read</span> base being misaligned. Applying this option greatly helps <span class="built_in">to</span> reduce <span class="literal">false</span> SNPs caused <span class="keyword">by</span> misalignments. </span><br><span class="line">-b FILE  List <span class="keyword">of</span> input BAM <span class="built_in">files</span>, <span class="literal">one</span> <span class="built_in">file</span> per <span class="built_in">line</span> [<span class="literal">null</span>]</span><br><span class="line">-C INT   Coefficient <span class="keyword">for</span> downgrading mapping quality <span class="keyword">for</span> reads containing excessive mismatches. Given <span class="keyword">a</span> <span class="built_in">read</span> <span class="keyword">with</span> <span class="keyword">a</span> phred-scaled probability q <span class="keyword">of</span> being generated <span class="built_in">from</span> <span class="keyword">the</span> mapped position, <span class="keyword">the</span> <span class="built_in">new</span> mapping quality is about <span class="built_in">sqrt</span>((INT-q)/INT)*INT. A <span class="literal">zero</span> <span class="built_in">value</span> disables this functionality; <span class="keyword">if</span> enabled, <span class="keyword">the</span> recommended <span class="built_in">value</span> <span class="keyword">for</span> BWA is <span class="number">50.</span> [<span class="number">0</span>] </span><br><span class="line">-d INT   At <span class="keyword">a</span> position, <span class="built_in">read</span> maximally INT reads per input BAM. [<span class="number">250</span>] </span><br><span class="line">-E       Extended BAQ computation. This option helps sensitivity especially <span class="keyword">for</span> MNPs, but may hurt specificity <span class="keyword">a</span> little bit. </span><br><span class="line">-f FILE  The faidx-indexed reference <span class="built_in">file</span> <span class="keyword">in</span> <span class="keyword">the</span> FASTA <span class="built_in">format</span>. The <span class="built_in">file</span> can be optionally compressed <span class="keyword">by</span> razip. [<span class="literal">null</span>] </span><br><span class="line">-l FILE  BED <span class="keyword">or</span> position list <span class="built_in">file</span> containing <span class="keyword">a</span> list <span class="keyword">of</span> regions <span class="keyword">or</span> sites where pileup <span class="keyword">or</span> BCF should be generated [<span class="literal">null</span>] </span><br><span class="line">-M INT       cap mapping quality <span class="keyword">at</span> INT [<span class="number">60</span>]</span><br><span class="line">-q INT 	Minimum mapping quality <span class="keyword">for</span> <span class="keyword">an</span> alignment <span class="built_in">to</span> be used [<span class="number">0</span>] </span><br><span class="line">-Q INT 	Minimum base quality <span class="keyword">for</span> <span class="keyword">a</span> base <span class="built_in">to</span> be considered [<span class="number">13</span>]</span><br><span class="line">-r STR 	Only generate pileup <span class="keyword">in</span> region STR [all sites] </span><br><span class="line"></span><br><span class="line">输出参数</span><br><span class="line">-D 	Output per-sample <span class="built_in">read</span> depth (<span class="built_in">require</span> -g/-u)</span><br><span class="line">-g 	Compute genotype likelihoods <span class="keyword">and</span> output them <span class="keyword">in</span> <span class="keyword">the</span> binary call <span class="built_in">format</span> (BCF). </span><br><span class="line">-S 	Output per-sample Phred-scaled strand bias P-<span class="built_in">value</span> (<span class="built_in">require</span> -g/-u) </span><br><span class="line">-u 	Similar <span class="built_in">to</span> -g except that <span class="keyword">the</span> output is uncompressed BCF, which is preferred <span class="keyword">for</span> piping. </span><br><span class="line"></span><br><span class="line">Options <span class="keyword">for</span> Genotype Likelihood Computation (<span class="keyword">for</span> -g <span class="keyword">or</span> -u):</span><br><span class="line">-e INT 	Phred-scaled gap extension sequencing error probability. Reducing INT leads <span class="built_in">to</span> longer indels. [<span class="number">20</span>] </span><br><span class="line">-h INT 	Coefficient <span class="keyword">for</span> modeling homopolymer errors. Given <span class="keyword">an</span> l-<span class="keyword">long</span> homopolymer run, <span class="keyword">the</span> sequencing error <span class="keyword">of</span> <span class="keyword">an</span> indel <span class="keyword">of</span> size s is modeled <span class="keyword">as</span> INT*s/l. [<span class="number">100</span>] </span><br><span class="line">-I 	Do <span class="keyword">not</span> perform INDEL calling </span><br><span class="line">-L INT 	Skip INDEL calling <span class="keyword">if</span> <span class="keyword">the</span> <span class="built_in">average</span> per-sample depth is above INT. [<span class="number">250</span>] </span><br><span class="line">-o INT 	Phred-scaled gap <span class="built_in">open</span> sequencing error probability. Reducing INT leads <span class="built_in">to</span> more indel calls. [<span class="number">40</span>] </span><br><span class="line">-P STR 	Comma dilimited list <span class="keyword">of</span> platforms (determined <span class="keyword">by</span> @RG-PL) <span class="built_in">from</span> which indel candidates are obtained. It is recommended <span class="built_in">to</span> collect indel candidates <span class="built_in">from</span> sequencing technologies that have low indel error rate such <span class="keyword">as</span> ILLUMINA. [all]</span><br></pre></td></tr></table></figure></p>
<h2 id="12-使用bcftools"><a href="#12-使用bcftools" class="headerlink" title="12. 使用bcftools"></a>12. 使用bcftools</h2><p>bcftools和samtools类似，用于处理vcf(variant call format)文件和bcf(binary call format)文件。前者为文本文件，后者为其二进制文件。</p>
<p>bcftools使用简单，最主要的命令是view命令，其次还有index和cat等命令。index和cat命令和samtools中类似。此处主讲使用view命令来进行SNP和Indel calling。该命令的使用方法和例子为：</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ bcftools view <span class="string">[-AbFGNQSucgv]</span> <span class="string">[-D seqDict]</span> <span class="string">[-l listLoci]</span> <span class="string">[-s listSample]</span> </span><br><span class="line">          <span class="string">[-i gapSNPratio]</span> <span class="string">[-t mutRate]</span> <span class="string">[-p varThres]</span> <span class="string">[-P prior]</span> </span><br><span class="line">          <span class="string">[-1 nGroup1]</span> <span class="string">[-d minFrac]</span> <span class="string">[-U nPerm]</span> <span class="string">[-X permThres]</span> </span><br><span class="line">          <span class="string">[-T trioType]</span> in.bcf <span class="string">[region]</span></span><br><span class="line"></span><br><span class="line">$ bcftools view -cvNg abc.bcf &gt; snp_indel.vcf</span><br></pre></td></tr></table></figure>
<p>生成的结果文件为vcf格式，有10列，分别是：1 参考序列名；2 varianti所在的left-most位置；3 variant的ID（默认未设置，用’.’表示)；4 参考序列的allele；5 variant的allele(有多个alleles，则用’,’分隔);6 variant/reference QUALity;7 FILTers applied;8 variant的信息，使用分号隔开；9 FORMAT of the genotype fields, separated by colon (optional)； 10 SAMPLE genotypes and per-sample information (optional)。<br>例如：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">scaffold_1      <span class="number">2847</span>    .       A       AACGGTGAAG      <span class="number">194</span>     .       INDEL;DP=<span class="number">11</span>;VDB=<span class="number">0.0401</span>;AF1=<span class="number">1</span>;AC1=<span class="number">2</span>;DP4=<span class="number">0</span>,<span class="number">0</span>,<span class="number">8</span>,<span class="number">3</span>;MQ=<span class="number">35</span>;FQ=<span class="number">-67.5</span>   <span class="string">GT:</span><span class="string">PL:</span>GQ        <span class="number">1</span>/<span class="number">1</span>:<span class="number">235</span>,<span class="number">33</span>,<span class="number">0</span>:<span class="number">63</span></span><br><span class="line">scaffold_1      <span class="number">3908</span>    .       G       A       <span class="number">111</span>     .       DP=<span class="number">13</span>;VDB=<span class="number">0.0085</span>;AF1=<span class="number">1</span>;AC1=<span class="number">2</span>;DP4=<span class="number">0</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">7</span>;MQ=<span class="number">42</span>;FQ=<span class="number">-63</span>   <span class="string">GT:</span><span class="string">PL:</span>GQ        <span class="number">1</span>/<span class="number">1</span>:<span class="number">144</span>,<span class="number">36</span>,<span class="number">0</span>:<span class="number">69</span></span><br><span class="line">scaffold_1      <span class="number">4500</span>    .       A       G       <span class="number">31.5</span>    .       DP=<span class="number">8</span>;VDB=<span class="number">0.0034</span>;AF1=<span class="number">1</span>;AC1=<span class="number">2</span>;DP4=<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">3</span>;MQ=<span class="number">42</span>;FQ=<span class="number">-39</span>    <span class="string">GT:</span><span class="string">PL:</span>GQ        <span class="number">1</span>/<span class="number">1</span>:<span class="number">64</span>,<span class="number">12</span>,<span class="number">0</span>:<span class="number">21</span></span><br><span class="line">scaffold_1      <span class="number">4581</span>    .       TGGNGG  TGG     <span class="number">145</span>     .       INDEL;DP=<span class="number">8</span>;VDB=<span class="number">0.0308</span>;AF1=<span class="number">1</span>;AC1=<span class="number">2</span>;DP4=<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">8</span>;MQ=<span class="number">42</span>;FQ=<span class="number">-58.5</span>    <span class="string">GT:</span><span class="string">PL:</span>GQ        <span class="number">1</span>/<span class="number">1</span>:<span class="number">186</span>,<span class="number">24</span>,<span class="number">0</span>:<span class="number">45</span></span><br><span class="line">scaffold_1      <span class="number">4644</span>    .       G       A       <span class="number">195</span>     .       DP=<span class="number">21</span>;VDB=<span class="number">0.0198</span>;AF1=<span class="number">1</span>;AC1=<span class="number">2</span>;DP4=<span class="number">0</span>,<span class="number">0</span>,<span class="number">10</span>,<span class="number">10</span>;MQ=<span class="number">42</span>;FQ=<span class="number">-87</span> <span class="string">GT:</span><span class="string">PL:</span>GQ        <span class="number">1</span>/<span class="number">1</span>:<span class="number">228</span>,<span class="number">60</span>,<span class="number">0</span>:<span class="number">99</span></span><br><span class="line">scaffold_1      <span class="number">4827</span>    .       NACAAAGA        NA      <span class="number">4.42</span>    .       INDEL;DP=<span class="number">1</span>;AF1=<span class="number">1</span>;AC1=<span class="number">2</span>;DP4=<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>;MQ=<span class="number">40</span>;FQ=<span class="number">-37.5</span>       <span class="string">GT:</span><span class="string">PL:</span>GQ        <span class="number">0</span>/<span class="number">1</span>:<span class="number">40</span>,<span class="number">3</span>,<span class="number">0</span>:<span class="number">3</span></span><br><span class="line">scaffold_1      <span class="number">4854</span>    .       A       G       <span class="number">48</span>      .       DP=<span class="number">6</span>;VDB=<span class="number">0.0085</span>;AF1=<span class="number">1</span>;AC1=<span class="number">2</span>;DP4=<span class="number">0</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">1</span>;MQ=<span class="number">41</span>;FQ=<span class="number">-36</span>    <span class="string">GT:</span><span class="string">PL:</span>GQ        <span class="number">1</span>/<span class="number">1</span>:<span class="number">80</span>,<span class="number">9</span>,<span class="number">0</span>:<span class="number">16</span></span><br><span class="line">scaffold_1      <span class="number">5120</span>    .       A       G       <span class="number">85</span>      .       DP=<span class="number">8</span>;VDB=<span class="number">0.0355</span>;AF1=<span class="number">1</span>;AC1=<span class="number">2</span>;DP4=<span class="number">0</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">3</span>;MQ=<span class="number">42</span>;FQ=<span class="number">-51</span>    <span class="string">GT:</span><span class="string">PL:</span>GQ        <span class="number">1</span>/<span class="number">1</span>:<span class="number">118</span>,<span class="number">24</span>,<span class="number">0</span>:<span class="number">45</span></span><br></pre></td></tr></table></figure></p>
<p>第8列中显示了对variants的信息描述，比较重要，其中的 Tag 的描述如下：<br><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Tag	Format	Description</span><br><span class="line">AF1	double	Max-likelihood estimate <span class="keyword">of</span> <span class="keyword">the</span> site allele frequency (AF) <span class="keyword">of</span> <span class="keyword">the</span> <span class="keyword">first</span> ALT allele</span><br><span class="line">DP	int	Raw <span class="built_in">read</span> depth (<span class="keyword">without</span> quality filtering)</span><br><span class="line">DP4	int[<span class="number">4</span>]	<span class="comment"># high-quality reference forward bases, ref reverse, alternate for and alt rev bases</span></span><br><span class="line">FQ	int	Consensus quality. Positive: sample genotypes different; negative: otherwise</span><br><span class="line">MQ	int	Root-Mean-Square mapping quality <span class="keyword">of</span> covering reads</span><br><span class="line">PC2	int[<span class="number">2</span>]	Phred probability <span class="keyword">of</span> AF <span class="keyword">in</span> group1 samples being larger (,smaller) than <span class="keyword">in</span> group2</span><br><span class="line">PCHI2	double	Posterior weighted chi^<span class="number">2</span> P-<span class="built_in">value</span> between group1 <span class="keyword">and</span> group2 samples</span><br><span class="line">PV4	double[<span class="number">4</span>]	P-<span class="built_in">value</span> <span class="keyword">for</span> strand bias, baseQ bias, mapQ bias <span class="keyword">and</span> tail distance bias</span><br><span class="line">QCHI2	int	Phred-scaled PCHI2</span><br><span class="line">RP	int	<span class="comment"># permutations yielding a smaller PCHI2</span></span><br><span class="line">CLR	int	Phred <span class="built_in">log</span> ratio <span class="keyword">of</span> genotype likelihoods <span class="keyword">with</span> <span class="keyword">and</span> <span class="keyword">without</span> <span class="keyword">the</span> trio/pair constraint</span><br><span class="line">UGT	<span class="keyword">string</span>	Most probable genotype configuration <span class="keyword">without</span> <span class="keyword">the</span> trio constraint</span><br><span class="line">CGT	<span class="keyword">string</span>	Most probable configuration <span class="keyword">with</span> <span class="keyword">the</span> trio constraint</span><br></pre></td></tr></table></figure></p>
<p>bcftools view 的具体参数如下：</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">Input/Output Options:</span><br><span class="line">-A 	Retain all possible alternate alleles <span class="keyword">at</span> variant sites. By default, <span class="keyword">the</span> view <span class="keyword">command</span> <span class="title">discards</span> <span class="title">unlikely</span> <span class="title">alleles</span>.</span><br><span class="line">-b 	Output <span class="keyword">in</span> <span class="keyword">the</span> BCF <span class="built_in">format</span>. The default is VCF.</span><br><span class="line">-D FILE Sequence dictionary (list <span class="keyword">of</span> chromosome names) <span class="keyword">for</span> VCF-&gt;BCF conversion [<span class="literal">null</span>]</span><br><span class="line">-F 	Indicate PL is generated <span class="keyword">by</span> r921 <span class="keyword">or</span> <span class="keyword">before</span> (ordering is different).</span><br><span class="line">-G 	Suppress all individual genotype information.</span><br><span class="line">-l FILE List <span class="keyword">of</span> sites <span class="keyword">at</span> which information are outputted [all sites]</span><br><span class="line">-N 	Skip sites where <span class="keyword">the</span> REF field is <span class="keyword">not</span> A/C/G/T</span><br><span class="line">-Q 	Output <span class="keyword">the</span> QCALL likelihood <span class="built_in">format</span></span><br><span class="line">-s FILE List <span class="keyword">of</span> samples <span class="built_in">to</span> use. The <span class="keyword">first</span> column <span class="keyword">in</span> <span class="keyword">the</span> input gives <span class="keyword">the</span> sample names <span class="keyword">and</span> <span class="keyword">the</span> <span class="keyword">second</span> gives <span class="keyword">the</span> ploidy, which can only be <span class="number">1</span> <span class="keyword">or</span> <span class="number">2.</span> When <span class="keyword">the</span> <span class="number">2</span>nd column is absent, <span class="keyword">the</span> sample ploidy is assumed <span class="built_in">to</span> be <span class="number">2.</span> In <span class="keyword">the</span> output, <span class="keyword">the</span> ordering <span class="keyword">of</span> samples will be identical <span class="built_in">to</span> <span class="keyword">the</span> <span class="literal">one</span> <span class="keyword">in</span> FILE. [<span class="literal">null</span>]</span><br><span class="line">-S 	The input is VCF instead <span class="keyword">of</span> BCF.</span><br><span class="line">-u 	Uncompressed BCF output (force -b). </span><br><span class="line"></span><br><span class="line">Consensus/Variant Calling Options:</span><br><span class="line">-c 	Call variants <span class="keyword">using</span> Bayesian inference. This option automatically invokes option -e.</span><br><span class="line">-d FLOAT When -v is <span class="keyword">in</span> use, skip loci where <span class="keyword">the</span> fraction <span class="keyword">of</span> samples covered <span class="keyword">by</span> reads is below FLOAT. [<span class="number">0</span>]</span><br><span class="line">        当有多个sample用于variants calling时，比如多个转录组数据或多个重测序</span><br><span class="line">        数据需要比对到参考基因组上，设置该值，表明至少有该&lt;float <span class="number">0</span>~<span class="number">1</span>&gt;比例的</span><br><span class="line">        samples在该位点都有覆盖才计算入variant.所以对于只有一个sample的情况</span><br><span class="line">        下，该值设置在<span class="number">0</span>～<span class="number">1</span>之间没有意义，大于<span class="number">1</span>则得不到任何结果。</span><br><span class="line">-e 	Perform <span class="built_in">max</span>-likelihood inference only, including estimating <span class="keyword">the</span> site allele frequency, testing Hardy-Weinberg equlibrium <span class="keyword">and</span> testing associations <span class="keyword">with</span> LRT.</span><br><span class="line">-g 	Call per-sample genotypes <span class="keyword">at</span> variant sites (force -c)</span><br><span class="line">-i FLOAT Ratio <span class="keyword">of</span> INDEL-<span class="built_in">to</span>-SNP mutation rate [<span class="number">0.15</span>]</span><br><span class="line">-p FLOAT A site is considered <span class="built_in">to</span> be <span class="keyword">a</span> variant <span class="keyword">if</span> P(ref|D)</span><br><span class="line">-t FLOAT Scaled muttion rate <span class="keyword">for</span> variant calling [<span class="number">0.001</span>]</span><br><span class="line">-T STR 	Enable pair/trio calling. For trio calling, option -s is usually needed <span class="built_in">to</span> be applied <span class="built_in">to</span> configure <span class="keyword">the</span> trio members <span class="keyword">and</span> their ordering. In <span class="keyword">the</span> <span class="built_in">file</span> supplied <span class="built_in">to</span> <span class="keyword">the</span> option -s, <span class="keyword">the</span> <span class="keyword">first</span> sample must be <span class="keyword">the</span> child, <span class="keyword">the</span> <span class="keyword">second</span> <span class="keyword">the</span> father <span class="keyword">and</span> <span class="keyword">the</span> <span class="keyword">third</span> <span class="keyword">the</span> mother. The valid values <span class="keyword">of</span> STR are ‘pair’, ‘trioauto’, ‘trioxd’ <span class="keyword">and</span> ‘trioxs’, where ‘pair’ calls differences between <span class="literal">two</span> input samples, <span class="keyword">and</span> ‘trioxd’ (‘trioxs’) specifies that <span class="keyword">the</span> input is <span class="built_in">from</span> <span class="keyword">the</span> X chromosome non-PAR regions <span class="keyword">and</span> <span class="keyword">the</span> child is <span class="keyword">a</span> female (male). [<span class="literal">null</span>]</span><br><span class="line">-v 	Output variant sites only (force -c) </span><br><span class="line"></span><br><span class="line">Contrast Calling <span class="keyword">and</span> Association Test Options:</span><br><span class="line"><span class="number">-1</span> INT 	Number <span class="keyword">of</span> group<span class="number">-1</span> samples. This option is used <span class="keyword">for</span> dividing <span class="keyword">the</span> samples <span class="keyword">into</span> <span class="literal">two</span> groups <span class="keyword">for</span> contrast SNP calling <span class="keyword">or</span> association test. When this option is <span class="keyword">in</span> use, <span class="keyword">the</span> following VCF INFO will be outputted: PC2, PCHI2 <span class="keyword">and</span> QCHI2. [<span class="number">0</span>]</span><br><span class="line">-U INT 	Number <span class="keyword">of</span> permutations <span class="keyword">for</span> association test (<span class="keyword">effective</span> only <span class="keyword">with</span> <span class="number">-1</span>) [<span class="number">0</span>]</span><br><span class="line">-X FLOAT Only perform permutations <span class="keyword">for</span> P(chi^<span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<p>使用bcftools得到variant calling结果后。需要对结果再次进行过滤。主要依据比对结果中第8列信息。其中的 DP4 一行尤为重要，提供了4个数据：1 比对结果和正链一致的reads数、2 比对结果和负链一致的reads数、3 比对结果在正链的variant上的reads数、4 比对结果在负链的variant上的reads数。可以设定 （value3 + value4）大于某一阈值，才算是variant。比如：<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ perl -ne '<span class="keyword">print</span> <span class="variable">$_</span> <span class="keyword">if</span> /DP4=(\<span class="keyword">d</span>+),(\<span class="keyword">d</span>+),(\<span class="keyword">d</span>+),(\<span class="keyword">d</span>+)/ &amp;&amp; (<span class="variable">$3</span>+<span class="variable">$4</span>)&gt;=10 &amp;&amp; (<span class="variable">$3</span>+<span class="variable">$4</span>)/(<span class="variable">$1</span>+<span class="variable">$2</span>+<span class="variable">$3</span>+<span class="variable">$4</span>)&gt;=0.8' snp_indel.vcf &gt; snp_indel.final.vcf</span><br></pre></td></tr></table></figure></p>
<h2 id="13-samtools-rmdup"><a href="#13-samtools-rmdup" class="headerlink" title="13. samtools rmdup"></a>13. samtools rmdup</h2><p>NGS上机测序前需要进行PCR一步，使一个模板扩增出一簇，从而在上机测序的时候表现出为1个点，即一个reads。若一个模板扩增出了多簇，结果得到了多个reads，这些reads的坐标(coordinates)是相近的。在进行了reads比对后需要将这些由PCR duplicates获得的reads去掉，并只保留最高比对质量的read。使用rmdup命令即可完成.<br><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Usage:  samtools rmdup [-sS]  </span><br><span class="line">-<span class="ruby">s 对single-<span class="keyword">end</span> reads。默认情况下，只对paired-<span class="keyword">end</span> reads</span><br><span class="line"></span>-<span class="ruby">S 将Paired-<span class="keyword">end</span> reads作为single-<span class="keyword">end</span> reads处理。</span><br><span class="line"></span></span><br><span class="line">$ samtools input.sorted.bam output.bam</span><br></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
  
  
</search>
